<mat-table #table [dataSource]="dataSource" matSort>

  <ng-container matColumnDef="date">
    <mat-header-cell fxFlex="120px" *matHeaderCellDef mat-sort-header> Datum</mat-header-cell>
    <mat-cell fxFlex="120px" *matCellDef="let element"> {{element.receivedAt | date:'short'}}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="sender">
    <mat-header-cell fxFlex="70px" *matHeaderCellDef mat-sort-header> Sender</mat-header-cell>
    <mat-cell fxFlex="70px" *matCellDef="let element"> {{element.sender}}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="numpages">
    <mat-header-cell fxFlex="50px" *matHeaderCellDef mat-sort-header> Seiten</mat-header-cell>
    <mat-cell fxFlex="50px" fxLayoutAlign="center" *matCellDef="let element"> {{element.pages.length}}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="comment">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Kommentar </mat-header-cell>
    <mat-cell *matCellDef="let element" [matTooltip]="element.comment"> {{ (element.comment.length>6)? (element.comment
      | slice:0:12)+'...':(element.comment)}}
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="actions">
    <mat-header-cell fxFlex="40px" *matHeaderCellDef></mat-header-cell>
    <mat-cell fxFlex="40px" class="action-group" *matCellDef="let element">
      <div *ngIf="element.requiredAction == ''">
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="deleteRecord($event, element)">
            <mat-icon color="warn" aria-label="delete">delete</mat-icon>
            <span>Löschen</span>
          </button>
          <button mat-menu-item (click)="setRequiredAction(element, 'escalated')">
            <mat-icon aria-label="escalate">arrow_upward</mat-icon>
            <span>Eskalieren</span>
          </button>
          <button mat-menu-item (click)="setRequiredAction(element, 'other')">
            <mat-icon aria-label="other">shopping_basket</mat-icon>
            <span>Werbung</span>
          </button>
        </mat-menu>
      </div>

      <div *ngIf="element.requiredAction == 'escalated'">
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="deleteRecord($event, element)">
            <mat-icon color="warn" aria-label="delete">delete</mat-icon>
            <span>Löschen</span>
          </button>
          <button mat-menu-item (click)="setRequiredAction(element, '')">
            <mat-icon aria-label="deescalate">arrow_downward</mat-icon>
            <span>Deeskalieren</span>
          </button>
        </mat-menu>
      </div>

      <div *ngIf="element.requiredAction == 'review'">
        <button mat-icon-button (click)="$event.stopPropagation()">
          <mat-icon aria-label="done" color="green">done</mat-icon>
        </button>
      </div>
    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
  <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selectRow(row)" (dblclick)="rowDoubleClick(row)"
           [class.selected]="row.id == selectedRecordId" draggable droppable [dragData]="row" [dragScope]="'record'"
           [dropScope]="'record'" (onDrop)="drop(row, $event)"></mat-row>
</mat-table>
